<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="robots" content="noindex"> 

    <title>Авторизация</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/js/jquery-1.12.1.min.js"></script>
    <script src="/js/jquery.cookie.js"          type="text/javascript"></script>
    <script src="/js/jquery.jsonrpc.js"          type="text/javascript"></script>
    <script src="/js/jquery.rpcapi.js"           type="text/javascript"></script>

    <link media="all" type="text/css" rel="stylesheet" href="/css/bootstrap.min.css">
    <link media="all" type="text/css" rel="stylesheet" href="/css/main.css ">
</head>
<body>
  <div class="container">
      <div class="card card-container">
          <img id="profile-img" class="profile-img-card" src="//ssl.gstatic.com/accounts/ui/avatar_2x.png" />
          <p id="profile-name" class="profile-name-card">Авторизация</p>
          <form class="form-signin" onSubmit="return sendLogin(this)">
              <div id="log" class="form-status"></div>
              <div class="input-group">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                  <input id="login" type="text" class="form-control" name="login" value="" placeholder="Логин" required autofocus>                                        
              </div>
              <div class="input-group">
                  <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                  <input id="password" type="password" class="form-control" name="password" value="" placeholder="Пароль" required>                                        
              </div>
              <div class="checkbox">
                  <label>
                      <input type="checkbox" id="remember" name="remember"> Запомнить меня
                  </label>
              </div>
              <button class="btn btn-primary btn-block btn-signin" type="submit">Войти</button>
          </form><!-- /form -->
          <a href="#" class="forgot-password" onClick="return showHelp()">
              Забыли пароль?
          </a>
      </div><!-- /card-container -->
  </div><!-- /container -->
  <script type="text/javascript">
    function sendLogin(form) {
      $('#log').html('Авторизация...').removeClass('alert-danger').addClass('alert-info');
      $.rpc.api({
        Form:      form,
        nameSpace: 'Auth',
        Method:    'Login',
        onSuccess: function(result) {
          $('#log').html('Успех')
          var attr = { path: '/' }
          if ($("#remember").prop("checked")) attr.expires = 14;
          $.cookie('elfire_sso_token', result.JWT, attr);
          location.reload(true);
        },
        onError:   function(error) {
          $('#log').html('Ошибка: ' + error.message).removeClass('alert-info').addClass('alert-danger');
        }
      });
      return false;
    }

    function showHelp() {
      $('#log').html('Для восстановления пароля обратитесь к администратору').removeClass('alert-danger').addClass('alert-info');
    }

    $(document).ready(function(){
      $.rpc.setup();
      $.cookie.json = false;
    });
  </script>
</body>
</html>
